(function(b,a,c){c.fn.lazyjson=function(e){var j=this,m=null,k=null,f=null,g=["lazyLoad","nextBtn","custom"],n=["prevBtn"],l=null,d=false,i=false,h={},o,p=c.extend(true,{},c.fn.lazyjson.defaults,e);j.init=function(){j.checkOpts();if(p.loadOnInit){j.load(true)}if(p.pagination.active){if(p.pagination.lazyLoad){c(b).scroll(function(){var q=j.position();if((c(b).height()+c(b).scrollTop())>(q.top+j.height())){l="lazyLoad";j.load()}})}else{c(j.parent()).on("click",p.pagination.nextBtn,function(q){q.preventDefault();l="nextBtn";j.load()});c(j.parent()).on("click",p.pagination.prevBtn,function(q){q.preventDefault();l="prevBtn";j.load()});if(p.pagination.loadOnEvent&&p.pagination.loadOnTarget){c("body").on(p.pagination.loadOnEvent,"#"+p.pagination.loadOnTarget,function(q){q.preventDefault();l="custom";j.load()})}}}};j.debug=function(q,r,s){if(a&&a.log){if(p.debug&&q&&r&&s){a.log({name:q,type:r,data:s})}}};j.checkOpts=function(){if(!c(p.childEl+"#"+p.templatePrefix+c(j).attr("id")).length){j.debug("templateNotFound","error","The template object was not found.")}else{o=c(p.childEl+"#"+p.templatePrefix+c(j).attr("id")).clone().removeAttr("id").removeAttr("style");c("#"+p.templatePrefix+c(j).attr("id")).remove()}if(!p.api.uri){j.debug("invalidApiUri","error","Please provide an API endpoint in options.api.uri .")}if(!p.api.httpMethod||c.inArray(p.api.httpMethod,["GET","POST"])===-1){j.debug("invalidHttpMethod","error","Please provide a valid HTTP method.")}if(!(p.loader instanceof jQuery)){p.loader=c(p.loader);p.loader.children("img").attr("src",p.loaderImg)}if(!(p.noResults instanceof jQuery)){p.noResults=c(p.noResults).text(p.noResultsText)}};j.load=function(q){if(!d){d=true;if(!p.pagination.appendResults&&l!=="lazyLoad"||c.inArray(l,["nextBtn","prevBtn"])!==-1){c(".lazyjson-template",j).remove()}if(c.inArray(l,g)!==-1&&i===false){m+=1}else{if(c.inArray(l,n)!==-1){m-=1}else{j.debug("currEvent","error","The event is not defined in pagination settings.")}}j.debug("currEvent","notice",l);j.loader(true);h=c.extend(true,h,c(j).data(),p.params);if(p.pagination.active){if(m<=0){m=1}if(q){m=1;k=p.pagination.pages*p.pagination.count;f=(m-1)*k}else{m=m||1;k=k||p.pagination.count;f=(m-1)*k}if(p.api.pagination){h[p.api.pagesKey]=m;h[p.api.limitKey]=k;h[p.api.offsetKey]=f}}j.debug("pagination","notice",{page:m,count:k,offset:f});c.ajax({type:p.api.httpMethod.toUpperCase(),url:p.api.uri,data:h,dataType:j.getDataType()}).done(function(r){if(r){if(p.pagination.active&&!p.api.pagination){r=r.slice(f,f+k)}if(r.length===0){i=true;j.append(p.noResults)}else{i=false;p.noResults.remove();j.build(r)}}if(q){m=p.pagination.pages;k=p.pagination.count}}).fail(function(r,s){}).always(function(){j.loader(false);setTimeout(function(){d=false},800);p.afterLoad()})}};j.build=function(q){if(typeof q!=="object"){j.debug("invalidJSON","error","The response must be a valid JSON object.");if(typeof q==="string"){c(j.append("<p>"+q+"</p>"))}}else{c.each(q,function(s,r){var u=o.clone(),t=j.parseObj(u.html(),r);u.html(t).addClass("lazyjson-template").appendTo(j);if(p.effect!==null){u.hide();setTimeout(function(){if(p.effect==="fadeIn"){u.fadeIn("fast")}else{if(p.effect==="slideDown"){u.slideDown("fast")}}},p.delay*s)}})}};j.parseObj=function(r,t,q){if(q){q=q+"."}else{q=""}if(typeof t==="object"){c.each(t,function(w,u){if(u===null){u=""}if(typeof u==="object"&&w){r=j.parseObj(r,u,q+w)}else{var x=new RegExp("{{"+q+w+"}}","g");r=r.replace(x,u)}})}else{if(typeof t==="string"){var s=new RegExp("{{value}}","g");r=r.replace(s,t)}}return r};j.getDataType=function(){var r=document.createElement("a"),q=document.createElement("a");r.href=document.URL;q.href=p.api.uri;if(q.hostname===r.hostname){return"json"}else{return"jsonp"}};j.loader=function(q){if(q){j.append(p.loader)}else{c(p.loader,j).remove()}};if(c(this).length!==0){j.init()}else{j.debug("invalidMainElement","error","The main object "+this+" does not exist.")}};c.fn.lazyjson.defaults={childEl:"div",templatePrefix:"template-",debug:false,loadOnInit:true,loader:'<div id="lj-loader" style="text-align:center;padding:20px;"><img /></div>',noResults:'<div id="lj-noresponse" style="text-align:center;padding:20px;"></div>',noResultsText:"No Results Found",loaderImg:null,delay:50,effect:null,pagination:{active:false,pages:1,count:10,appendResults:false,lazyLoad:false,nextBtn:"a.next",prevBtn:"a.previous",loadOnEvent:null,loadOnTarget:null},api:{uri:null,httpMethod:"GET",pagination:false,pagesKey:"page",limitKey:"limit",offsetKey:"offset",params:null},afterLoad:function(){},beforeLoad:function(){}}})(window,console,jQuery);